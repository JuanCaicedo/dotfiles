---
name: vanna-env-sync
description: Syncs .env.local files across vanna-connect project clones by finding the most recent files and copying them to all projects. Use when environment files need to be synchronized across multiple vanna-connect repositories, when setup changes need to propagate, or when user mentions syncing envs, environment files, or .env.local files.
allowed-tools:
  - Bash
  - Read
---

# Vanna Environment Sync

Synchronizes `.env.local` files across all vanna-connect project clones in `~/code/vanna`.

## Quick Start

Run this skill to:
1. Find all vanna-connect projects
2. Identify the most recent `.env.local` files
3. Copy them to all other projects

The skill syncs these files:
- `typescript/servers/api-service/.env.local`
- `typescript/servers/automations-service/.env.local`
- `typescript/servers/adt-service/.env.local`
- `typescript/apps/cli/.env.local`
- `typescript/apps/admin/.env.local`
- `typescript/apps/web/.env.local`

## Instructions

Follow this workflow:

### Step 1: Find All Projects

```bash
for dir in ~/code/vanna/*/; do
  if [ -d "${dir}typescript" ]; then
    basename "$dir"
  fi
done
```

This identifies all directories in `~/code/vanna` that contain a `typescript` subdirectory.

### Step 2: Find Most Recent Files

```bash
find ~/code/vanna -name ".env.local" -type f -exec ls -lt {} + 2>/dev/null | head -30
```

Look for the files with the most recent modification timestamps. The source project will be the one with the newest files.

### Step 3: Copy Files to All Projects

Use this script template:

```bash
#!/bin/bash
# Source directory with the most recent .env.local files
SOURCE_DIR="/Users/juan.caicedo/code/vanna/[SOURCE_PROJECT]/typescript"

# Target projects (excluding the source)
PROJECTS=(
  # List all projects except the source
)

# Files to copy with their relative paths
FILES=(
  "servers/api-service/.env.local"
  "servers/automations-service/.env.local"
  "servers/adt-service/.env.local"
  "apps/cli/.env.local"
  "apps/admin/.env.local"
  "apps/web/.env.local"
)

# Copy files to each project
for project in "${PROJECTS[@]}"; do
  echo "Copying to $project..."
  for file in "${FILES[@]}"; do
    SOURCE_FILE="$SOURCE_DIR/$file"
    TARGET_FILE="/Users/juan.caicedo/code/vanna/$project/typescript/$file"

    if [ -f "$SOURCE_FILE" ]; then
      # Create directory if it doesn't exist
      mkdir -p "$(dirname "$TARGET_FILE")"
      cp "$SOURCE_FILE" "$TARGET_FILE"
      echo "  ✓ Copied $file"
    else
      echo "  ✗ Source file not found: $file"
    fi
  done
  echo ""
done

echo "Done! Verifying copied files..."
find ~/code/vanna -name ".env.local" -type f -exec ls -lt {} + 2>/dev/null | head -30
```

### Step 4: Report Results

After copying, show:
- Source project used
- Number of files copied
- List of target projects updated
- Verification of new timestamps

## Examples

**Example 1: Sync from most recent project**

Input: User runs `/vanna-env-sync`

Process:
1. Find projects: `burrito-vanna-connect-2`, `taco-vanna-connect`, `vanna-connect`, etc.
2. Identify most recent: `burrito-vanna-connect-2` (Feb 10 14:15)
3. Copy 6 files to 6 other projects (36 files total)

Output:
```
✓ Synced .env.local files from burrito-vanna-connect-2

Files copied:
- servers/api-service/.env.local
- servers/automations-service/.env.local
- servers/adt-service/.env.local
- apps/cli/.env.local
- apps/admin/.env.local
- apps/web/.env.local

To projects:
- taco-vanna-connect
- vanna-connect
- vanna-connect-2
- vanna-connect-exploration
- vanna-connect-FT-654
- taco-backup

All files updated to Feb 11 11:52
```

**Example 2: No recent files found**

If no `.env.local` files exist, inform the user:
```
No .env.local files found in any vanna-connect projects.
Run the localSetup command to generate them first.
```

## Guidelines

- Always identify the most recent files by timestamp
- Exclude the source project from the copy targets
- Create target directories if they don't exist
- Preserve file permissions when copying
- Show verification of timestamps after copying
- Handle missing files gracefully with clear messages
- Use absolute paths to avoid directory confusion

## Common Scenarios

**After running localSetup:**
The skill detects which project has the newest setup and propagates it to all others.

**After manual edits:**
If you manually update .env.local in one project, run this to sync across all projects.

**Before switching projects:**
Ensure all projects have consistent environment configuration before changing your working directory.

## Notes

- These files are auto-generated by the localSetup command
- Manual edits will be lost on next localSetup run
- For persistent changes, edit `.env` instead of `.env.local`
- The skill always syncs from the most recent files, not from a specific project
